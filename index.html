<script>
  window.onload = function () {
    const scriptURL = "https://script.google.com/macros/s/AKfycbx6I_kYRjizHxX8QeVnE2J0Ico0dAyBwf9jF1X8D0WJ2P6FLBf-8MMj4EeH8ZaphJFI8w/exec"; // à¹ƒà¸Šà¹‰ URL à¹ƒà¸«à¸¡à¹ˆà¸«à¸¥à¸±à¸‡ deploy
    liff.init({ liffId: "2007371280-lY274ANQ" })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          liff.getProfile().then(profile => {
            const userId = profile.userId;
            const name = profile.displayName;

            fetch(scriptURL, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ userId, name })
            })
            .then(response => response.json())
            .then(result => {
              console.log("âœ… Server response:", result);
              document.body.innerHTML = `<h2>âœ… Registration Complete ğŸ‰</h2><p>Thanks, ${name}!</p>`;
              setTimeout(() => { liff.closeWindow(); }, 3000);
            })
            .catch(error => {
              console.error("âŒ Registration failed:", error);
              document.body.innerHTML = `<h2>âŒ Registration failed</h2><p>Please try again later.</p>`;
            });
          });
        }
      })
      .catch(error => {
        console.error("âŒ LIFF init failed:", error);
        document.body.innerHTML = `<h2>âŒ LIFF Initialization Failed</h2>`;
      });
  };
</script>
