<body>
  <h2>Registering...</h2>

  <!-- ‚úÖ Load LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

  <!-- ‚úÖ ‡∏£‡∏≠‡πÉ‡∏´‡πâ SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const scriptURL = "https://script.google.com/macros/s/AKfycbx6I_kYRjizHxX8QeVnE2J0Ico0dAyBwf9jF1X8D0WJ2P6FLBf-8MMj4EeH8ZaphJFI8w/exec";

      // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ liff ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß
      if (typeof liff === "undefined") {
        document.body.innerHTML = "<h2>‚ùå LIFF SDK failed to load</h2>";
        return;
      }

      liff.init({ liffId: "2007371280-lY274ANQ" })
        .then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            liff.getProfile().then(profile => {
              const userId = profile.userId;
              const name = profile.displayName;

              fetch(scriptURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, name })
              })
              .then(response => response.text())
              .then(result => {
                console.log("‚úÖ Server response:", result);
                document.body.innerHTML = `<h2>‚úÖ Registration Complete üéâ</h2><p>Thanks, ${name}!</p>`;
                setTimeout(() => { liff.closeWindow(); }, 3000);
              })
              .catch(error => {
                console.error("‚ùå Registration failed:", error);
                document.body.innerHTML = `<h2>‚ùå Registration failed</h2><p>Please try again later.</p>`;
              });
            });
          }
        })
        .catch(error => {
          console.error("‚ùå LIFF init failed:", error);
          document.body.innerHTML = `<h2>‚ùå LIFF Initialization Failed</h2>`;
        });
    });
  </script>
</body>
