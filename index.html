<body>
  <h2>Registering...</h2>

  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    window.onload = function () {
      const scriptURL = "https://script.google.com/macros/s/AKfycbyeENoK1cB99YblIvqQ_fdpn9hRqKfb1rnRQmYWfAGwA8U5pYxs_OysHuXcmcQ-utEvDg/exec";
      liff.init({ liffId: "2007371280-lY274ANQ" })
        .then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            liff.getProfile().then(profile => {
              const userId = profile.userId;
              const name = profile.displayName;

              fetch(scriptURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, name })
              })
              .then(response => response.text())
              .then(result => {
                console.log("✅ Server response:", response);
                return response.text();
                document.body.innerHTML = `<h2>✅ Registration Complete 🎉</h2><p>Thanks, ${name}!</p>`;
                setTimeout(() => { liff.closeWindow(); }, 3000);
              })
              .catch(error => {
                console.error("❌ Registration failed:", error);
                document.body.innerHTML = `<h2>❌ Registration failed</h2><p>Please try again later.</p>`;
              });
            });
          }
        })
        .catch(error => {
          console.error("❌ LIFF init failed:", error);
          document.body.innerHTML = `<h2>❌ LIFF Initialization Failed</h2>`;
        });
    };
  </script>
</body>
