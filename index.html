<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Registering...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
  <h2>Registering...</h2>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbx6I_kYRjizHxX8QeVnE2J0Ico0dAyBwf9jF1X8D0WJ2P6FLBf-8MMj4EeH8ZaphJFI8w/exec";

    window.onload = function () {
      liff.init({ liffId: "2007371280-lY274ANQ" })
        .then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            liff.getProfile().then(profile => {
              const userId = profile.userId;
              const name = profile.displayName;

              const formData = new URLSearchParams();
              formData.append("name", name);
              formData.append("userId", userId);

              fetch(scriptURL, {
                method: 'POST',
                body: formData
              })
              .then(response => response.text())
              .then(result => {
                console.log("✅ Server response:", result);
                document.body.innerHTML = `<h2>✅ Registration Complete 🎉</h2><p>Thanks, ${name}!</p>`;
                setTimeout(() => { liff.closeWindow(); }, 3000);
              })
              .catch(error => {
                console.error("❌ Registration failed:", error);
                document.body.innerHTML = `<h2>❌ Registration failed</h2><p>Please try again later.</p>`;
              });
            });
          }
        })
        .catch(error => {
          console.error("❌ LIFF init failed:", error);
          document.body.innerHTML = `<h2>❌ LIFF Initialization Failed</h2>`;
        });
    };
  </script>
</body>
</html>
